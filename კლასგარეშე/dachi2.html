<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dynamic Parking Game</title>
<style>
  body { margin:0; font-family:sans-serif; background:#222; color:white; display:flex; flex-direction:column; align-items:center; }
  #ui { margin:10px; text-align:center; }
  #game { position:relative; width:600px; height:700px; background:#eee; border:3px solid #333; overflow:hidden; }
  #trailCanvas { position:absolute; z-index:1; }
  .car { position:absolute; border-radius:5px; transform-origin:center center; z-index:2; }
  #player { z-index:2; }
  .wall { position:absolute; background:#333; z-index:2; }
  #parking { position:absolute; border:2px dashed green; background:rgba(0,255,0,0.3); z-index:0; }
  button { margin:3px; padding:3px 8px; }
</style>
</head>
<body>

<div id="ui">
  <div>Level: <span id="levelNum">1</span> | Money: $<span id="money">0</span></div>
  <div>
    <button onclick="buyCar(0)">Compact ($0)</button>
    <button onclick="buyCar(1)">Sports ($100)</button>
    <button onclick="buyCar(2)">SUV ($200)</button>
    <button onclick="buyCar(3)">Truck ($300)</button>
    <button onclick="restartGame()">Restart</button>
  </div>
</div>

<div id="game">
  <canvas id="trailCanvas" width="600" height="700"></canvas>
  <div id="player" class="player"></div>
  <div id="parking"></div>
</div>

<script>
const game = document.getElementById('game');
const playerEl = document.getElementById('player');
const parkingEl = document.getElementById('parking');
const levelNumEl = document.getElementById('levelNum');
const moneyEl = document.getElementById('money');
const trailCanvas = document.getElementById('trailCanvas');
const ctx = trailCanvas.getContext('2d');

const cars = [
  { name: "Compact", speed: 3, size:{w:40,h:70}, price:0, color:'red' },
  { name: "Sports", speed: 5, size:{w:35,h:60}, price:100, color:'orange' },
  { name: "SUV", speed: 2, size:{w:50,h:80}, price:200, color:'blue' },
  { name: "Truck", speed: 2, size:{w:60,h:100}, price:300, color:'brown' }
];

let playerCar = cars[0];
let level = 1;
let money = 0;
let playerPos = {x:280, y:600, angle:0};
let velocity = {x:0,y:0};
let keys = {};
let walls = [];
let gameOver = false;

// Generate 200 levels with random parking spots
const levels = Array.from({length:200}, (_,i)=>({
  parking: { x:50 + Math.random()*500, y:50 + Math.random()*400, w:50, h:80 },
  walls: [
    {x:0,y:0,w:600,h:20},{x:0,y:0,w:20,h:700},{x:0,y:680,w:600,h:20},{x:580,y:0,w:20,h:700},
    {x:100+Math.random()*400, y:100+Math.random()*400, w:100,h:20}
  ]
}));

document.addEventListener('keydown', e=> keys[e.key]=true);
document.addEventListener('keyup', e=> keys[e.key]=false);

function buyCar(index){
  const car = cars[index];
  if(money>=car.price){ playerCar = car; money-=car.price; moneyEl.textContent=money; initLevel(); alert(car.name+" purchased!"); }
  else alert("Not enough money!");
}

function restartGame(){ level=1; money=0; moneyEl.textContent=money; initLevel(); }

function rectsIntersect(a,b){ return !(a.right<b.left || a.left>b.right || a.bottom<b.top || a.top>b.bottom); }

function initLevel(){
  document.querySelectorAll('.wall').forEach(w=>w.remove());
  const lvl = levels[level-1];
  walls = lvl.walls.map(w=>{
    const el = document.createElement('div');
    el.className='wall';
    el.style.left=w.x+'px'; el.style.top=w.y+'px';
    el.style.width=w.w+'px'; el.style.height=w.h+'px';
    game.appendChild(el);
    return { ...w, el };
  });

  const p = lvl.parking;
  parkingEl.style.left = p.x+'px';
  parkingEl.style.top = p.y+'px';
  parkingEl.style.width = p.w+'px';
  parkingEl.style.height = p.h+'px';

  // Player starts in the middle
  playerPos = {x:game.offsetWidth/2 - playerCar.size.w/2, y:game.offsetHeight/2 - playerCar.size.h/2, angle:0};
  velocity = {x:0,y:0};
  playerEl.style.width = playerCar.size.w+'px';
  playerEl.style.height = playerCar.size.h+'px';
  playerEl.style.background = playerCar.color;

  levelNumEl.textContent = level;
  gameOver=false;
  ctx.clearRect(0,0,trailCanvas.width,trailCanvas.height);
}

initLevel();

function update(){
  if(gameOver) return;

  // Controls
  if(keys['ArrowLeft']||keys['a']) playerPos.angle-=3;
  if(keys['ArrowRight']||keys['d']) playerPos.angle+=3;
  if(keys['ArrowUp']||keys['w']){
    velocity.x += playerCar.speed*Math.sin(playerPos.angle*Math.PI/180)/2;
    velocity.y -= playerCar.speed*Math.cos(playerPos.angle*Math.PI/180)/2;
  }
  if(keys['ArrowDown']||keys['s']){
    velocity.x -= playerCar.speed*Math.sin(playerPos.angle*Math.PI/180)/2;
    velocity.y += playerCar.speed*Math.cos(playerPos.angle*Math.PI/180)/2;
  }

  // Move player
  const newX = playerPos.x + velocity.x;
  const newY = playerPos.y + velocity.y;
  const newRect = {left:newX, top:newY, right:newX+playerCar.size.w, bottom:newY+playerCar.size.h};

  const collision = walls.some(w=> rectsIntersect(newRect,{left:w.x,top:w.y,right:w.x+w.w,bottom:w.y+w.h}));
  if(!collision){
    // Draw trail behind car
    ctx.fillStyle = playerCar.color;
    ctx.globalAlpha = 0.3;
    ctx.fillRect(playerPos.x+playerCar.size.w/2, playerPos.y+playerCar.size.h/2, 2,2);

    playerPos.x = newX; playerPos.y = newY;
  } else { velocity={x:0,y:0}; }

  playerEl.style.left = playerPos.x+'px';
  playerEl.style.top = playerPos.y+'px';
  playerEl.style.transform = `rotate(${playerPos.angle}deg)`;
  velocity.x *= 0.9; velocity.y *= 0.9;

  // Parking check
  const p = levels[level-1].parking;
  const pRect = {left:p.x, top:p.y, right:p.x+p.w, bottom:p.y+p.h};
  if(newRect.left>=pRect.left && newRect.right<=pRect.right && newRect.top>=pRect.top && newRect.bottom<=pRect.bottom){
    money += 50;
    moneyEl.textContent = money;
    level++;
    if(level>200){ alert("You completed all 200 levels!"); level=1; money=0; }
    initLevel();
  }

  requestAnimationFrame(update);
}

update();
</script>

</body>
</html>
